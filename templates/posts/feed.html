{% extends "base.html" %}
{% block content %}
<h2>News Feed</h2>

<form method="post">
  {% csrf_token %}
  <textarea name="text" class="form-control mb-2" rows="3" placeholder="–©–æ —É –≤–∞—Å –Ω–æ–≤–æ–≥–æ?"></textarea>
  <button class="btn btn-primary">–û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏</button>
</form>

<hr>

{% for post in posts %}
  <div class="card mb-3">
    <div class="card-body">
      <strong>{{ post.author.username }}</strong> ¬∑ {{ post.created_at|date:"H:i d.m.Y" }}
      <p>{{ post.text }}</p>

      <!-- –õ–∞–π–∫–∏ -->
      <form action="{% url 'posts:toggle_like' post.id %}" method="post" style="display:inline">
        {% csrf_token %}
        <button class="btn btn-sm {% if post.liked_by_user %}btn-danger{% else %}btn-outline-danger{% endif %}">
          ‚ù§ {{ post.like_count }}
        </button>
      </form>

      <!-- –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è/–≤–∏–¥–∞–ª–µ–Ω–Ω—è -->
      {% if post.author == user %}
        <a href="{% url 'posts:edit_post' post.id %}" class="btn btn-sm btn-warning">‚úé</a>
        <a href="{% url 'posts:delete_post' post.id %}" class="btn btn-sm btn-danger">üóë</a>
      {% endif %}

      <!-- –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ -->
      <div class="mt-2">
        {% for comment in post.comments.all %}
          <p>
            <b>{{ comment.author.username }}</b>: {{ comment.text }}
            {% if comment.author == user %}
              <a href="{% url 'posts:delete_comment' comment.id %}" class="text-danger">[x]</a>
            {% endif %}
          </p>
        {% endfor %}

        <form action="{% url 'posts:add_comment' post.id %}" method="post">
          {% csrf_token %}
          <input type="text" name="text" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –∫–æ–º–µ–Ω—Ç–∞—Ä..." class="form-control form-control-sm">
        </form>
      </div>
    </div>
  </div>
{% empty %}
  <p>–©–µ –Ω–µ–º–∞—î –ø–æ—Å—Ç—ñ–≤ üôÉ</p>
{% endfor %}
{% endblock %}
